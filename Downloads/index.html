<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bowling Scorecard</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const RotateCcw = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M1 4v6h6"/>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
      </svg>
    );

    const BowlingScorecard = () => {
      const [playerName, setPlayerName] = useState('PLAYER 1');
      const [frames, setFrames] = useState(Array(10).fill(null).map(() => ({ balls: [], score: null, isSplit: false, pinLeaves: [] })));
      const [currentFrame, setCurrentFrame] = useState(0);
      const [currentBall, setCurrentBall] = useState(0);
      const [pinLeave, setPinLeave] = useState([]);
      const [pinLeaveForBall, setPinLeaveForBall] = useState(null);
      const [seriesTotal, setSeriesTotal] = useState(0);
      const [gameScores, setGameScores] = useState([]);
      const [logoUrl, setLogoUrl] = useState(null);
      const [editMode, setEditMode] = useState({ active: false, frame: null, ball: null });

      useEffect(() => {
        const savedLogo = localStorage.getItem('bowlingLogo');
        if (savedLogo) {
          setLogoUrl(savedLogo);
        }
      }, []);

      const handleLogoUpload = (event) => {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const logoData = e.target.result;
            setLogoUrl(logoData);
            localStorage.setItem('bowlingLogo', logoData);
          };
          reader.readAsDataURL(file);
        }
      };

      const handleLogoUrl = (url) => {
        if (url.trim()) {
          setLogoUrl(url.trim());
          localStorage.setItem('bowlingLogo', url.trim());
        }
      };

      const removeLogo = () => {
        setLogoUrl(null);
        localStorage.removeItem('bowlingLogo');
      };

      const calculateScore = (newFrames) => {
        for (let i = 0; i < 10; i++) {
          let totalScore = 0;
          let canCalculate = true;
          
          for (let j = 0; j <= i; j++) {
            const frame = newFrames[j];
            if (!frame.balls || frame.balls.length === 0) {
              canCalculate = false;
              break;
            }
            
            if (j < 9) {
              if (frame.balls[0] === 10) {
                const next1 = newFrames[j+1]?.balls?.[0];
                const next2 = next1 === 10 && j < 8 ? newFrames[j+2]?.balls?.[0] : newFrames[j+1]?.balls?.[1];
                if (next1 !== undefined && next2 !== undefined) {
                  totalScore += 10 + next1 + next2;
                } else {
                  canCalculate = false;
                  break;
                }
              } else if (frame.balls.length >= 2) {
                const sum = frame.balls[0] + frame.balls[1];
                if (sum === 10) {
                  const next1 = newFrames[j+1]?.balls?.[0];
                  if (next1 !== undefined) {
                    totalScore += 10 + next1;
                  } else {
                    canCalculate = false;
                    break;
                  }
                } else {
                  totalScore += sum;
                }
              } else {
                canCalculate = false;
                break;
              }
            } else {
              const ballCount = frame.balls.length;
              const needsThirdBall = frame.balls[0] === 10 || (ballCount >= 2 && frame.balls[0] + frame.balls[1] === 10);
              if (needsThirdBall && ballCount < 3) {
                canCalculate = false;
                break;
              } else if (!needsThirdBall && ballCount < 2) {
                canCalculate = false;
                break;
              } else {
                totalScore += frame.balls.reduce((sum, ball) => sum + (ball || 0), 0);
              }
            }
          }
          
          newFrames[i].score = canCalculate ? totalScore : null;
        }
        
        return newFrames;
      };

      const recordScore = (value) => {
        const newFrames = [...frames];
        
        if (editMode.active) {
          const { frame: editFrame, ball: editBall } = editMode;
          if (!newFrames[editFrame].balls) {
            newFrames[editFrame].balls = [];
          }
          newFrames[editFrame].balls[editBall] = value;
          setFrames(calculateScore(newFrames));
          setEditMode({ active: false, frame: null, ball: null });
          return;
        }
        
        if (currentFrame >= 10) return;
        
        if (!newFrames[currentFrame].balls) {
          newFrames[currentFrame].balls = [];
        }
        
        newFrames[currentFrame].balls.push(value);
        
        if (!newFrames[currentFrame].pinLeaves) {
          newFrames[currentFrame].pinLeaves = [];
        }
        newFrames[currentFrame].pinLeaves.push([...pinLeave]);
        
        setPinLeave([]);
        setPinLeaveForBall(null);
        
        setFrames(calculateScore(newFrames));
        
        if (currentFrame < 9) {
          if (value === 10) {
            setCurrentFrame(currentFrame + 1);
            setCurrentBall(0);
          } else if (currentBall === 1) {
            setCurrentFrame(currentFrame + 1);
            setCurrentBall(0);
          } else {
            setCurrentBall(1);
          }
        } else {
          if (newFrames[9].balls.length === 3) {
            setCurrentFrame(10);
            setCurrentBall(0);
          } else if (newFrames[9].balls.length === 2) {
            const earnedThirdBall = newFrames[9].balls[0] === 10 || newFrames[9].balls[0] + newFrames[9].balls[1] === 10;
            if (!earnedThirdBall) {
              setCurrentFrame(10);
              setCurrentBall(0);
            } else {
              setCurrentBall(2);
            }
          } else {
            setCurrentBall(1);
          }
        }
      };

      const getValidScores = () => {
        const pinsStanding = pinLeave.length;
        const pinsDown = 10 - pinsStanding;
        
        if (editMode.active) {
          const frame = frames[editMode.frame];
          if (editMode.frame === 9) {
            if (editMode.ball === 0) {
              return Array.from({ length: 11 }, (_, i) => i);
            } else if (editMode.ball === 1) {
              if (frame.balls[0] === 10) {
                return Array.from({ length: 11 }, (_, i) => i);
              } else {
                const pinsLeftAfterBall1 = 10 - frame.balls[0];
                const pinsMarkedAsConverted = pinsStanding;
                const validScores = [];
                for (let i = pinsMarkedAsConverted; i <= pinsLeftAfterBall1; i++) {
                  validScores.push(i);
                }
                return validScores;
              }
            } else {
              const earnedThirdBall = frame.balls[0] === 10 || (frame.balls[0] !== 10 && frame.balls[0] + frame.balls[1] === 10);
              if (!earnedThirdBall) return [];
              const freshRack = (frame.balls[0] === 10 && frame.balls[1] === 10) || (frame.balls[0] !== 10 && frame.balls[0] + frame.balls[1] === 10);
              if (freshRack) {
                return Array.from({ length: pinsDown + 1 }, (_, i) => i);
              } else {
                const pinsMarkedAsConverted = pinsStanding;
                const pinsLeftAfterBall2 = frame.balls[0] === 10 ? (10 - frame.balls[1]) : 0;
                const validScores = [];
                for (let i = pinsMarkedAsConverted; i <= pinsLeftAfterBall2; i++) {
                  validScores.push(i);
                }
                return validScores;
              }
            }
          } else {
            if (editMode.ball === 0) {
              return Array.from({ length: pinsDown + 1 }, (_, i) => i);
            } else {
              const pinsLeftAfterBall1 = 10 - frame.balls[0];
              const pinsMarkedAsConverted = pinsStanding;
              const validScores = [];
              for (let i = pinsMarkedAsConverted; i <= pinsLeftAfterBall1; i++) {
                validScores.push(i);
              }
              return validScores;
            }
          }
        }
        
        if (currentFrame >= 10) return [];
        
        if (currentFrame === 9) {
          const frame = frames[9];
          if (currentBall === 0) {
            return Array.from({ length: 11 }, (_, i) => i);
          } else if (currentBall === 1) {
            if (frame.balls[0] === 10) {
              return Array.from({ length: 11 }, (_, i) => i);
            } else {
              const pinsLeftAfterBall1 = 10 - frame.balls[0];
              const isPinLeaveForCurrentBall = pinLeaveForBall === currentBall;
              let pinsMarkedAsConverted = isPinLeaveForCurrentBall ? pinsStanding : 0;
              const validScores = [];
              for (let i = pinsMarkedAsConverted; i <= pinsLeftAfterBall1; i++) {
                validScores.push(i);
              }
              return validScores;
            }
          } else {
            const earnedThirdBall = frame.balls[0] === 10 || (frame.balls[0] !== 10 && frame.balls[0] + frame.balls[1] === 10);
            if (!earnedThirdBall) return [];
            const freshRack = (frame.balls[0] === 10 && frame.balls[1] === 10) || (frame.balls[0] !== 10 && frame.balls[0] + frame.balls[1] === 10);
            if (freshRack) {
              return Array.from({ length: pinsDown + 1 }, (_, i) => i);
            } else {
              const pinsMarkedAsConverted = pinsStanding;
              const pinsLeftAfterBall2 = frame.balls[0] === 10 ? (10 - frame.balls[1]) : 0;
              const validScores = [];
              for (let i = pinsMarkedAsConverted; i <= pinsLeftAfterBall2; i++) {
                validScores.push(i);
              }
              return validScores;
            }
          }
        }
        
        if (currentBall === 0) {
          return Array.from({ length: pinsDown + 1 }, (_, i) => i);
        } else {
          const frame = frames[currentFrame];
          const pinsLeftAfterBall1 = 10 - frame.balls[0];
          const isPinLeaveForCurrentBall = pinLeaveForBall === currentBall;
          let pinsMarkedAsConverted = isPinLeaveForCurrentBall ? pinsStanding : 0;
          const validScores = [];
          for (let i = pinsMarkedAsConverted; i <= pinsLeftAfterBall1; i++) {
            validScores.push(i);
          }
          return validScores;
        }
      };

      const validScores = getValidScores();
      const isScoreValid = (score) => validScores.includes(score);

      const editBallScore = (frameIdx, ballIdx) => {
        if (frameIdx < 9 && ballIdx === 1 && frames[frameIdx].balls[0] === 10) return;
        if (!frames[frameIdx].balls || frames[frameIdx].balls.length <= ballIdx) return;
        
        setEditMode({ active: true, frame: frameIdx, ball: ballIdx });
        
        if (frames[frameIdx].pinLeaves && frames[frameIdx].pinLeaves[ballIdx]) {
          setPinLeave([...frames[frameIdx].pinLeaves[ballIdx]]);
          setPinLeaveForBall(ballIdx);
        } else {
          setPinLeave([]);
          setPinLeaveForBall(null);
        }
      };

      const clickPinDiagram = (frameIdx) => {
        const frame = frames[frameIdx];
        if (!frame.balls || frame.balls.length === 0) return;
        
        let ballToEdit = 0;
        if (frame.balls[0] === 10) return;
        else if (frame.balls.length === 1) ballToEdit = 0;
        else ballToEdit = 1;
        
        if (frame.pinLeaves && frame.pinLeaves[ballToEdit]) {
          setPinLeave([...frame.pinLeaves[ballToEdit]]);
          setPinLeaveForBall(ballToEdit);
        } else {
          setPinLeave([]);
          setPinLeaveForBall(null);
        }
        
        setEditMode({ active: true, frame: frameIdx, ball: ballToEdit, editingPinLeave: true });
      };

      const savePinLeaveEdit = () => {
        if (!editMode.active || !editMode.editingPinLeave) return;
        
        const newFrames = [...frames];
        if (!newFrames[editMode.frame].pinLeaves) {
          newFrames[editMode.frame].pinLeaves = [];
        }
        newFrames[editMode.frame].pinLeaves[editMode.ball] = [...pinLeave];
        setFrames(newFrames);
        setEditMode({ active: false, frame: null, ball: null });
        setPinLeave([]);
        setPinLeaveForBall(null);
      };

      const markAsSplit = () => {
        if (currentFrame >= 10 || currentBall !== 1) return;
        const newFrames = [...frames];
        newFrames[currentFrame].isSplit = true;
        setFrames(newFrames);
      };

      const nextGame = () => {
        const finalScore = frames[9]?.score;
        if (finalScore !== null && finalScore !== undefined) {
          setGameScores([...gameScores, finalScore]);
          setSeriesTotal(seriesTotal + finalScore);
        }
        resetGame();
      };

      const resetGame = () => {
        setFrames(Array(10).fill(null).map(() => ({ balls: [], score: null, isSplit: false, pinLeaves: [] })));
        setCurrentFrame(0);
        setCurrentBall(0);
        setPinLeave([]);
        setPinLeaveForBall(null);
      };

      const resetSeries = () => {
        resetGame();
        setSeriesTotal(0);
        setGameScores([]);
      };

      const renderBallScore = (frameIdx, ballIdx) => {
        const frame = frames[frameIdx];
        
        if (frameIdx < 9) {
          if (frame.balls[0] === 10) {
            if (ballIdx === 0) return '';
            if (ballIdx === 1) return 'X';
          }
          
          const value = frame.balls[ballIdx];
          if (value === undefined || value === null) return '';
          
          if (ballIdx === 0) {
            if (value === 0) return '-';
            return value;
          }
          if (ballIdx === 1) {
            if (frame.balls[0] + value === 10) return '/';
            if (value === 0) return '-';
            return value;
          }
        } else {
          const value = frame.balls[ballIdx];
          if (value === undefined || value === null) return '';
          if (value === 10) return 'X';
          if (ballIdx > 0 && frame.balls[ballIdx - 1] !== 10 && frame.balls[ballIdx - 1] + value === 10) return '/';
          if (value === 0) return '-';
          return value;
        }
      };

      const renderPinDiagram = (frameIdx) => {
        const frame = frames[frameIdx];
        const pinLayout = [[7,8,9,10], [4,5,6], [2,3], [1]];
        
        const renderSinglePinSet = (pinsToShow, color = 'bg-white', small = false) => {
          return (
            <div className={`flex flex-col items-center gap-0.5 ${small ? 'scale-75' : ''}`}>
              {pinLayout.map((row, rowIdx) => (
                <div key={rowIdx} className="flex gap-0.5">
                  {row.map(pin => (
                    <div key={pin} className={`w-1 h-1 rounded-full ${pinsToShow.includes(pin) ? color : 'bg-white'}`} />
                  ))}
                </div>
              ))}
            </div>
          );
        };
        
        if (!frame.balls || frame.balls.length === 0) {
          return renderSinglePinSet([], 'bg-white');
        }
        
        if (frameIdx === 9) {
          const pinSets = [];
          
          if (frame.balls[0] === 10) {
            pinSets.push(<div key="ball1" className="inline-block">{renderSinglePinSet([], 'bg-white', true)}</div>);
            
            if (frame.balls.length === 1) {
              pinSets.push(<div key="ball2" className="inline-block mx-0.5">{renderSinglePinSet([], 'bg-white', true)}</div>);
            } else if (frame.balls[1] === 10) {
              pinSets.push(<div key="ball2" className="inline-block mx-0.5">{renderSinglePinSet([], 'bg-white', true)}</div>);
              
              if (frame.balls.length === 2) {
                pinSets.push(<div key="ball3" className="inline-block mx-0.5">{renderSinglePinSet([], 'bg-white', true)}</div>);
              } else if (frame.balls.length === 3) {
                const ball3Leave = frame.pinLeaves && frame.pinLeaves[2] ? frame.pinLeaves[2] : [];
                pinSets.push(<div key="ball3" className="inline-block mx-0.5">{renderSinglePinSet(ball3Leave, 'bg-green-500', true)}</div>);
              }
            } else if (frame.balls.length === 2) {
              const ball2Leave = frame.pinLeaves && frame.pinLeaves[1] ? frame.pinLeaves[1] : [];
              pinSets.push(<div key="ball2" className="inline-block mx-0.5">{renderSinglePinSet(ball2Leave, 'bg-green-500', true)}</div>);
            } else if (frame.balls.length === 3) {
              const ball2Leave = frame.pinLeaves && frame.pinLeaves[1] ? frame.pinLeaves[1] : [];
              const ball3Leave = frame.pinLeaves && frame.pinLeaves[2] ? frame.pinLeaves[2] : [];
              const converted = ball2Leave.filter(pin => !ball3Leave.includes(pin));
              const unconverted = ball2Leave.filter(pin => ball3Leave.includes(pin));
              
              const combinedPins = [...converted.map(p => ({ pin: p, color: 'bg-green-500' })), ...unconverted.map(p => ({ pin: p, color: 'bg-red-500' }))];
              const pinColors = {};
              combinedPins.forEach(({ pin, color }) => pinColors[pin] = color);
              
              pinSets.push(
                <div key="ball2" className="inline-block mx-0.5">
                  <div className="flex flex-col items-center gap-0.5 scale-75">
                    {pinLayout.map((row, rowIdx) => (
                      <div key={rowIdx} className="flex gap-0.5">
                        {row.map(pin => (
                          <div key={pin} className={`w-1 h-1 rounded-full ${pinColors[pin] || 'bg-white'}`} />
                        ))}
                      </div>
                    ))}
                  </div>
                </div>
              );
            }
          } else if (frame.balls.length >= 1) {
            const ball1Leave = frame.pinLeaves && frame.pinLeaves[0] ? frame.pinLeaves[0] : [];
            if (frame.balls.length === 1) {
              pinSets.push(<div key="ball1" className="inline-block">{renderSinglePinSet(ball1Leave, 'bg-green-500', true)}</div>);
            } else {
              const ball2Leave = frame.pinLeaves && frame.pinLeaves[1] ? frame.pinLeaves[1] : [];
              const converted = ball1Leave.filter(pin => !ball2Leave.includes(pin));
              const unconverted = ball1Leave.filter(pin => ball2Leave.includes(pin));
              
              const combinedPins = [...converted.map(p => ({ pin: p, color: 'bg-green-500' })), ...unconverted.map(p => ({ pin: p, color: 'bg-red-500' }))];
              const pinColors = {};
              combinedPins.forEach(({ pin, color }) => pinColors[pin] = color);
              
              pinSets.push(
                <div key="ball1" className="inline-block">
                  <div className="flex flex-col items-center gap-0.5 scale-75">
                    {pinLayout.map((row, rowIdx) => (
                      <div key={rowIdx} className="flex gap-0.5">
                        {row.map(pin => (
                          <div key={pin} className={`w-1 h-1 rounded-full ${pinColors[pin] || 'bg-white'}`} />
                        ))}
                      </div>
                    ))}
                  </div>
                </div>
              );
              
              if (frame.balls[0] + frame.balls[1] === 10) {
                if (frame.balls.length === 2) {
                  pinSets.push(<div key="ball3" className="inline-block mx-0.5">{renderSinglePinSet([], 'bg-white', true)}</div>);
                } else if (frame.balls.length === 3) {
                  const ball3Leave = frame.pinLeaves && frame.pinLeaves[2] ? frame.pinLeaves[2] : [];
                  pinSets.push(<div key="ball3" className="inline-block mx-0.5">{renderSinglePinSet(ball3Leave, 'bg-green-500', true)}</div>);
                }
              }
            }
          }
          
          return <div className="flex items-center justify-center">{pinSets}</div>;
        }
        
        if (frame.balls[0] === 10) {
          return renderSinglePinSet([], 'bg-white');
        } else if (frame.balls.length === 1 && frame.pinLeaves && frame.pinLeaves[0]) {
          const pinsLeft = frame.pinLeaves[0];
          return renderSinglePinSet(pinsLeft, 'bg-green-500');
        } else if (frame.balls.length === 2 && frame.pinLeaves && frame.pinLeaves[0] && frame.pinLeaves[1]) {
          const firstBallLeave = frame.pinLeaves[0];
          const secondBallLeave = frame.pinLeaves[1];
          const converted = firstBallLeave.filter(pin => !secondBallLeave.includes(pin));
          const unconverted = firstBallLeave.filter(pin => secondBallLeave.includes(pin));
          
          const combinedPins = [...converted.map(p => ({ pin: p, color: 'bg-green-500' })), ...unconverted.map(p => ({ pin: p, color: 'bg-red-500' }))];
          const pinColors = {};
          combinedPins.forEach(({ pin, color }) => pinColors[pin] = color);
          
          return (
            <div className="flex flex-col items-center gap-0.5">
              {pinLayout.map((row, rowIdx) => (
                <div key={rowIdx} className="flex gap-0.5">
                  {row.map(pin => (
                    <div key={pin} className={`w-1 h-1 rounded-full ${pinColors[pin] || 'bg-white'}`} />
                  ))}
                </div>
              ))}
            </div>
          );
        }
        
        return renderSinglePinSet([], 'bg-white');
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-blue-800 to-blue-900 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="bg-blue-600 border-4 border-blue-400 rounded-lg p-4 mb-4 relative overflow-hidden">
              {logoUrl && (
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden">
                  <img 
                    src={logoUrl} 
                    alt="AC Goes Bowling Background" 
                    className="opacity-25"
                    style={{ 
                      width: '60%', 
                      height: 'auto', 
                      objectFit: 'contain',
                      mixBlendMode: 'darken'
                    }}
                  />
                </div>
              )}
              
              <div className="relative z-10">
                <div className="flex justify-between items-center mb-2">
                  <div className="flex items-center gap-2">
                    <input
                      type="text"
                      value={playerName}
                      onChange={(e) => setPlayerName(e.target.value)}
                      className="text-2xl font-bold text-white bg-transparent border-none outline-none"
                    />
                  </div>
                  <div className="text-right">
                    <div className="text-sm text-blue-200">SERIES TOTAL</div>
                    <div className="text-4xl font-bold text-yellow-400">{seriesTotal}</div>
                  </div>
                </div>
              
              <div className="grid gap-0 bg-white" style={{ gridTemplateColumns: 'repeat(9, 1fr) 1.5fr' }}>
                {frames.map((frame, frameIdx) => {
                  const isActive = frameIdx === currentFrame;
                  return (
                    <div key={frameIdx} className={`border-2 ${isActive ? 'border-yellow-400 bg-yellow-100' : 'border-gray-800'}`}>
                      <div className="text-center font-bold border-b-2 border-gray-800 py-1 bg-white">
                        {frameIdx + 1}
                      </div>
                      <div className="flex justify-center py-1 bg-black cursor-pointer" onClick={() => clickPinDiagram(frameIdx)}>
                        {renderPinDiagram(frameIdx)}
                      </div>
                      <div className="grid grid-cols-2 border-b-2 border-gray-800">
                        {frameIdx < 9 ? (
                          <>
                            <div 
                              onClick={() => editBallScore(frameIdx, 0)}
                              className={`border-r border-gray-800 text-center py-2 font-bold bg-white relative cursor-pointer hover:bg-blue-50 ${frame.isSplit ? 'text-red-600' : ''} ${editMode.active && editMode.frame === frameIdx && editMode.ball === 0 ? 'ring-4 ring-yellow-400' : ''}`}>
                              {renderBallScore(frameIdx, 0)}
                              {frame.isSplit && frame.balls[0] && (
                                <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                  <div className="w-6 h-6 border-2 border-red-600 rounded-full"></div>
                                </div>
                              )}
                            </div>
                            <div 
                              onClick={() => editBallScore(frameIdx, 1)}
                              className={`text-center py-2 font-bold bg-white cursor-pointer hover:bg-blue-50 ${editMode.active && editMode.frame === frameIdx && editMode.ball === 1 ? 'ring-4 ring-yellow-400' : ''}`}>
                              {renderBallScore(frameIdx, 1)}
                            </div>
                          </>
                        ) : (
                          <div className="border-r border-gray-800 text-center py-2 font-bold bg-white col-span-2 grid grid-cols-3">
                            <div 
                              onClick={() => editBallScore(frameIdx, 0)}
                              className={`border-r border-gray-800 cursor-pointer hover:bg-blue-50 ${editMode.active && editMode.frame === frameIdx && editMode.ball === 0 ? 'ring-4 ring-yellow-400' : ''}`}>
                              {renderBallScore(frameIdx, 0)}
                            </div>
                            <div 
                              onClick={() => editBallScore(frameIdx, 1)}
                              className={`border-r border-gray-800 cursor-pointer hover:bg-blue-50 ${editMode.active && editMode.frame === frameIdx && editMode.ball === 1 ? 'ring-4 ring-yellow-400' : ''}`}>
                              {renderBallScore(frameIdx, 1)}
                            </div>
                            <div 
                              onClick={() => editBallScore(frameIdx, 2)}
                              className={`cursor-pointer hover:bg-blue-50 ${editMode.active && editMode.frame === frameIdx && editMode.ball === 2 ? 'ring-4 ring-yellow-400' : ''}`}>
                              {renderBallScore(frameIdx, 2)}
                            </div>
                          </div>
                        )}
                      </div>
                      <div className="text-center py-3 font-bold text-lg bg-white">
                        {frame.score !== null && frame.score !== undefined ? frame.score : ''}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div className="bg-yellow-100 border-4 border-gray-800 rounded-lg p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Pin Leave</h2>
                <div className="flex justify-center items-center h-64">
                  <div className="relative" style={{ width: '200px', height: '200px' }}>
                    {[
                      { pin: 7, x: 50, y: 20 },
                      { pin: 8, x: 90, y: 20 },
                      { pin: 9, x: 130, y: 20 },
                      { pin: 10, x: 170, y: 20 },
                      { pin: 4, x: 70, y: 70 },
                      { pin: 5, x: 110, y: 70 },
                      { pin: 6, x: 150, y: 70 },
                      { pin: 2, x: 90, y: 120 },
                      { pin: 3, x: 130, y: 120 },
                      { pin: 1, x: 110, y: 170 }
                    ].map(({ pin, x, y }) => {
                      const isStanding = pinLeave.includes(pin);
                      return (
                        <div
                          key={pin}
                          onClick={() => {
                            if (isStanding) {
                              setPinLeave(pinLeave.filter(p => p !== pin));
                            } else {
                              setPinLeave([...pinLeave, pin].sort());
                            }
                            setPinLeaveForBall(currentBall);
                          }}
                          className={`absolute w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg border-4 cursor-pointer ${
                            isStanding 
                              ? 'bg-white border-gray-600 text-gray-800' 
                              : 'bg-gray-300 border-gray-400 text-gray-500 opacity-50'
                          }`}
                          style={{ left: `${x}px`, top: `${y}px` }}
                        >
                          {pin}
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>

              <div className="bg-blue-600 border-4 border-blue-400 rounded-lg p-6">
                <h2 className="text-2xl font-bold text-white mb-4 text-center">
                  {editMode.active 
                    ? (editMode.editingPinLeave 
                        ? `Editing Pin Leave - Frame ${editMode.frame + 1}, Ball ${editMode.ball + 1}`
                        : `Editing Frame ${editMode.frame + 1}, Ball ${editMode.ball + 1}`)
                    : `Frame ${currentFrame + 1} - Roll ${currentBall + 1}`}
                </h2>
                <div className="grid grid-cols-4 gap-3 mb-4">
                  <button
                    onClick={() => recordScore(0)}
                    disabled={(currentFrame >= 10 && !editMode.active) || !isScoreValid(0)}
                    className="bg-blue-500 hover:bg-blue-600 disabled:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-lg text-xl border-2 border-blue-300"
                  >
                    -
                  </button>
                  {[1,2,3,4,5,6,7,8,9].map(num => (
                    <button
                      key={num}
                      onClick={() => recordScore(num)}
                      disabled={(currentFrame >= 10 && !editMode.active) || !isScoreValid(num)}
                      className="bg-blue-500 hover:bg-blue-600 disabled:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-lg text-xl border-2 border-blue-300"
                    >
                      {num}
                    </button>
                  ))}
                  <button
                    onClick={() => recordScore(10)}
                    disabled={(currentFrame >= 10 && !editMode.active) || !isScoreValid(10)}
                    className="bg-blue-500 hover:bg-blue-600 disabled:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-lg text-xl border-2 border-blue-300"
                  >
                    X
                  </button>
                </div>
                {editMode.active && editMode.editingPinLeave ? (
                  <button
                    onClick={savePinLeaveEdit}
                    className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg text-xl border-2 border-green-400"
                  >
                    Save Pin Leave
                  </button>
                ) : editMode.active ? (
                  <button
                    onClick={() => setEditMode({ active: false, frame: null, ball: null })}
                    className="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-4 rounded-lg text-xl border-2 border-gray-400"
                  >
                    Cancel Edit
                  </button>
                ) : (
                  <>
                    <button
                      onClick={markAsSplit}
                      disabled={currentFrame >= 10 || currentBall !== 1 || frames[currentFrame]?.isSplit}
                      className="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-500 text-white font-bold py-4 rounded-lg text-xl border-2 border-red-400 mb-3"
                    >
                      {frames[currentFrame]?.isSplit ? 'Split Marked âœ“' : 'Mark as Split'}
                    </button>
                    <button
                      onClick={() => setPinLeave([1,2,3,4,5,6,7,8,9,10])}
                      className="w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg border-2 border-slate-400"
                    >
                      Reset All Pins
                    </button>
                  </>
                )}
              </div>
            </div>

            <div className="flex justify-center gap-4 mt-4">
              <button 
                onClick={() => {
                  const url = prompt('Enter image URL (e.g., https://i.imgur.com/yourimage.png):');
                  if (url) handleLogoUrl(url);
                }}
                className="cursor-pointer bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-xl border-2 border-purple-400"
              >
                {logoUrl ? 'Change Logo (URL)' : 'Set Logo URL'}
              </button>
              <label className="cursor-pointer bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-8 rounded-lg text-xl border-2 border-purple-300">
                Upload Logo (File)
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleLogoUpload}
                  className="hidden"
                />
              </label>
              <button
                onClick={nextGame}
                className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-xl border-2 border-green-400"
              >
                Next Game
              </button>
              <button
                onClick={resetGame}
                className="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-8 rounded-lg text-xl border-2 border-gray-400 flex items-center gap-2"
              >
                <RotateCcw size={24} />
                Reset Game
              </button>
              <button
                onClick={resetSeries}
                className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg text-xl border-2 border-red-400"
              >
                Reset Series
              </button>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<BowlingScorecard />, document.getElementById('root'));
  </script>
</body>
</html>
